---
title: "EDA"
format: html
author: Powell Braddock
---

# Introduction

This project addresses the creation and selection of a predictive model on the [Diabetes Health Indicators Dataset](https://www.kaggle.com/datasets/alexteboul/diabetes-health-indicators-dataset/) from Kaggle. The target (or response) variable is `Diabetes_binary`, where there are two classes: **No Diabetes** and **Prediabetes or Diabetes**. We will use all 21 predictor variables: `HighBP, HighChol, CholCheck, BMI, Smoker, Stroke, HeartDiseaseorAttack, PhysActivity, Fruits, Veggies, HvyAlcoholConsump, AnyHealthcare, NoDocbcCost, Genhlth, MentHlth, PhysHlth, DiffWalk, Sex, Age, Education,` and `Income.` We will treat everything but `BMI` as a categorical variable and `BMI` as a numeric variable.

In this page, we will explore both categorical and numeric variables that we will model in the following page to finally select a model that **predicts the status of diabetes** in a patient the best.

# Data

First, let's bring in the data from our local R Project .csv and name it `diabetes_data`.

```{r}
library(tidyverse)
diabetes_data <- read.csv('diabetes_binary_health_indicators_BRFSS2015.csv')
head(diabetes_data)
```

That is quite interesting... our initial data makes no sense! Most of these variables are categorical, but they are saved right now as numerical. Let's fix that by making them factor-type variables and saving this converted data as `diabetes_convert`.

```{r}
diabetes_convert <- diabetes_data |>
  mutate(Diabetes_binary = factor(Diabetes_binary, 
                                  levels=c(0, 1), 
                                  labels=c('No Diabetes', 'Prediabetes or Diabetes')),
         HighBP = factor(HighBP,
                         levels = c(0, 1),
                         labels = c('No High BP', 'High BP')),
         HighChol = factor(HighChol,
                           levels = c(0, 1),
                           labels = c('No High Cholesterol', 'High Cholesterol')),
         CholCheck = factor(CholCheck,
                            levels = c(0, 1),
                            labels = c('No Cholesterol Check in Five Years', 
                                       'Cholesterol Check in Five Years')),
         Smoker = factor(Smoker,
                         levels = c(0, 1),
                         labels = c('Smoked Less than 100 Cigarettes in Life', 
                                    'Smoked More than 100 Cigarettes in Life')),
         Stroke = factor(Stroke,
                         levels = c(0,1),
                         labels = c('Has Never Had a Stroke', 'Has Had a Stroke')),
         HeartDiseaseorAttack = factor(HeartDiseaseorAttack,
                                       levels = c(0, 1),
                                       labels = c('No CHD or MI', 'CHD or MI')),
         PhysActivity = factor(PhysActivity,
                               levels = c(0, 1),
                               labels = c('No Physical Activity in Past 30 Days', 
                                          'Physical Activity in Past 30 Days')),
         Fruits = factor(Fruits,
                         levels = c(0, 1),
                         labels = c('Does Not Consume Fruit at Least Once Per Day', 
                                    'Consumes Fruit at Least Once Per Day')),
         Veggies = factor(Veggies,
                          levels = c(0, 1),
                          labels = c('Does Not Consume Vegetables at Least Once Per Day', 
                                    'Consumes Vegetables at Least Once Per Day')),
         HvyAlcoholConsump = factor(HvyAlcoholConsump,
                                    levels = c(0, 1),
                                    labels = c('No Heavy Alcohol Consumption', 
                                               'Heavy Alcohol Consumption')),
         AnyHealthcare = factor(AnyHealthcare,
                                levels = c(0, 1),
                                labels = c('Has No Healthcare', 
                                           'Has Healthcare')),
         NoDocbcCost = factor(NoDocbcCost,
                              levels = c(0, 1),
                              labels = c('No Time of Not Visiting Doctor Because of Cost',
                                         'Time Where Did Not Visit Doctor Because of Cost')),
         GenHlth = factor(GenHlth,
                          levels = c(1, 2, 3, 4, 5),
                          labels = c('Excellent', 'Very Good', 'Good', 'Fair', 'Poor')),
         MentHlth = factor(MentHlth),
         PhysHlth = factor(PhysHlth),
         DiffWalk = factor(DiffWalk,
                           levels = c(0, 1),
                           labels = c('No Difficulty Walking or Climbing Stairs', 
                                      'Difficulty Walking or Climbing Stairs')),
         Sex = factor(Sex,
                      levels = c(0, 1),
                      labels = c('Female', 'Male')),
         Age = factor(Age,
                      levels = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13),
                      labels = c('18-24', '25-29', '30-34','35-39', '40-44', '45-49',
                                 '50-54', '55-59', '60-64', '65-69', '70-74', '75-79',
                                 '80 or Older')),
         Education = factor(Education,
                            levels = c(1, 2, 3, 4, 5, 6),
                            labels = c('Never attended school or only kindergarten',
                                       'Grades 1-8 (Elementary)',
                                       'Grades 9-11 (Some high School)',
                                       'Grade 12 or GED (High School Graduate)',
                                       'College 1 Year to 3 Years (Some College or Technical School)',
                                       'College 4 Years or More (College Graduate)')),
         Income = factor(Income,
                         levels = c(1, 2, 3, 4, 5, 6, 7, 8),
                         labels = c('Less than $10,000',
                                    '$10,000 - $15,000',
                                    '$15,000 - $20,000',
                                    '$20,000 - $25,000',
                                    '$25,000 - $35,000',
                                    '$35,000 - $50,000',
                                    '$50,000 - $75,000',
                                    '$75,000 or More'
                                    ))
  )
head(diabetes_convert)

```

Much better. Now, we can check each variable for 'missingness' by using a counting function to show how many entries are 'NA', 'NULL', or 'NaN' in each column.

```{r}
sum_na <- function(column){
  sum(is.na(column) + is.null(column) + is.nan(column))
}
na_counts <- diabetes_convert |>
  summarize(across(everything(), sum_na))
na_counts
```

Looks like we are in luck... No missing entries in any columns. Phew.

# Summarizations

Now that we have the data cleaned and ready, we can explore summaries and graphs about the entire data set, which we've named `diabetes_convert`.

I began by summarizing our response variable of interest: `Diabetes_binary`, which indicates the diabetic status of the population, across the only numeric variable: `BMI`.

```{r}
diabetes_convert |>
  group_by(Diabetes_binary) |>
  summarize(across(BMI, .fns = list("mean" = mean, 
                                       "median" = median, 
                                       "var" = var, 
                                       "sd" = sd, 
                                       "IQR" = IQR), .names = "{.fn}_{.col}"))
```

Excellent, now we can see the differences in the mean, median, variance, standard deviation, and interquartile range of the BMIs for both patients with no diabetic status and prediabetic/diabetic status.

Patients with prediabetic/diabetic status have a 4 point average and median difference of BMI from patients with no diabetes. The variance and standard deviations are also wider for prediabetic/diabetic patients than those without diabetes.

Let's check out the **contingency table** of sex versus diabetic status.

```{r}
diabetes_convert |>
  group_by(Sex, Diabetes_binary) |>
  summarize(count=n()) |>
  mutate(Proportion = count/sum(count)) 
```

Perfect! We can see that for females, the proportion of patients with prediabetes/diabetes versus no diabetes is around 13%, while 15% of the male patients are prediabetic/diabetic. I wonder what else we can find...

```{r}
diabetes_convert |>
  group_by(Age, Diabetes_binary) |>
  summarize(count=n()) |>
  mutate(Proportion = count/sum(count)) 
  
```

It appears that the proportion of prediabetic/diabetic vs. non-diabetic patients increases until age group 70-74, then it decreases a little.

```{r}
diabetes_convert |>
  group_by(AnyHealthcare,HighBP,HighChol, Diabetes_binary) |>
  summarize(count=n()) |>
  mutate(Proportion = count/sum(count)) |>
  pivot_wider(names_from = Diabetes_binary, values_from = count)
```

This contingency table tells an interesting story...patients with no healthcare, high blood pressure, and high cholesterol have the highest rates of prediabetes/diabetes.

```{r}
diabetes_convert |>
  group_by(Income,Diabetes_binary) |>
  summarize(count=n()) |>
  mutate(Proportion = count/sum(count)) |>
  pivot_wider(names_from = Diabetes_binary, values_from = count)
```

26.2% of patients in the \$10k to \$15k income range have prediabetic/diabetic status, which is the highest percentage across income groups, followed by 24.2% of patients in the \$10k or less income group.

```{r}
diabetes_convert |>
  group_by(Education, Diabetes_binary) |>
  summarize(count=n()) |>
  mutate(Proportion = count/sum(count)) |>
  pivot_wider(names_from = Diabetes_binary, values_from = count)
```

Folks with only elementary education (29.3%) or lower (27%) had a much higher proportion of prediabetes/diabetes status than any further education category.

We can now check to see the diabetes status, sex, age, and BMI statistics all in one table.

```{r}
summary_stats <- diabetes_convert |> 
  group_by(Diabetes_binary, Sex, Age) |> 
  summarize(across(BMI, 
                   .fns = list(
                     "mean" = mean, "median" = median
                     ), 
                   .names = "{.fn}_{.col}"
                   )
            ) 
summary_stats
```

This is hard to comprehend, so let's turn it into a nice plot.

I'm using faceting to show the average BMI for non-diabetics versus prediabetics/diabetic and sex across age groups.

```{r}
library(ggplot2)
ggplot(summary_stats, aes(x = Diabetes_binary, y=mean_BMI, fill = Sex)) +
  geom_col(stat = 'identity', position = 'dodge') +
  facet_wrap(~Age) +
  labs(x='Diabetes Status',
       y='Average BMI',
       title = 'Average BMI versus Diabetes Status and Sex Across Age Groups') +
  guides(x=guide_axis(n.dodge = 2))
```

We can see that in each age group, regardless of the sex of the patient, patients with prediabetes/diabetes have higher average BMIs than patients with no diabetes status.

Let's check out a density plot to investigate the BMI variable.

```{r}
ggplot(diabetes_convert, aes(x=BMI,fill=Diabetes_binary, alpha = 5, linetype = Sex)) +
  geom_density(kernel='gaussian') +
  labs(title = 'Density of BMI Across Diabetes Status and Sex')
```

This density plot shows the varying frequencies of each BMI across both Diabetes Status and Sex. The 'No Diabetes' and 'Prediabetes or Diabetes' plots both have similar shapes, but the 'No Diabetes' plot is centered around a lower BMI. There appear to be more male patients than female patients as well. Both male and female patients follow similar patterns within the plots and there are only a few patients with BMIs greater than 50: where these are exclusively prediabetic/diabetic patients.

```{r}
saveRDS(diabetes_convert, 'diabetes_convert.rds')
```

[Click here for the Modeling Page](Modeling.html)
